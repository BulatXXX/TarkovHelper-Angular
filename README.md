# TarkovHelper — Описание программы (в формате README)
---

## 1. Общие сведения

**Наименование программы:** TarkovHelper (Web-приложение)

**Назначение:** приложение для ведения списка отслеживаемых предметов (tracked items) с возможностью авторизации пользователя и синхронизации списка с сервером.

**ПО для функционирования:**
- Frontend: Angular (standalone components), браузер (Chrome/Chromium/Safari).
- Backend API: HTTP-сервис (локально: `http://localhost:8080`).
- Внешний источник данных (для карточек предметов): `https://api.tarkov.dev/graphql` (GraphQL).

**Языки программирования:**
- Frontend: TypeScript / HTML / SCSS
- Backend: зависит от реализации сервера (в README описывается взаимодействие по HTTP API).

---

## 2. Функциональное назначение

Программа решает задачи:
- ведение **локального** списка отслеживаемых предметов (tracked items);
- отображение списка с данными предметов (название, цена за 24ч и т.д.);
- авторизация/регистрация пользователя;
- синхронизация локального списка с серверным списком;
- визуальная индикация состояния синхронизации (кнопка “облачко” + диалог сравнения/стратегий).

**Функциональные ограничения:**
- синхронизация доступна только для авторизованных пользователей;

---

## 3. Описание логической структуры

### 3.1. Основные сущности

**TrackedItem**
- `id: string` — идентификатор предмета
- `iconLink: string | null` — ссылка на иконку (может быть null)
- `updatedAt: number` — unix-time (ms), для LWW-слияния

### 3.2. Экран Profile

Экран Profile:
- показывает список tracked items;
- даёт переключатель режима (если используется);
- для авторизованного пользователя:
  - кнопка синхронизации (облачко) с индикацией состояния,
  - кнопка logout (дверь).

### 3.3. Синхронизация

Сервис синхронизации выполняет:
1) загрузку списка с сервера (`GET /tracked`);
2) получение локального списка (TrackedItemsService snapshot);
3) применение стратегии:
  - **serverToLocal**: заменить локальный список серверным;
  - **localToServer**: перезаписать сервер локальным;
  - **merge**: объединить по `updatedAt` (LWW) и отправить результат на сервер.
4) сохранение итогового списка локально (replaceAll).

**Merge (LWW):**
- при конфликте выбирается элемент с максимальным `updatedAt`;
- `iconLink` подтягивается аккуратно: если у победителя `null`, берём у проигравшего, иначе `null`.

### 3.4. Сравнение списков (diff)

Для того чтобы пользователь видел, что **локальный и серверный списки отличаются**, используется сравнение:
- `onlyLocal` — есть только локально
- `onlyServer` — есть только на сервере
- `conflicts` — есть в обоих, но различаются (updatedAt/iconLink)
- `inSync` — отличий нет


---

## 4. Используемые технические средства

**Клиент:**
- ПК/ноутбук, современный браузер.
- Node.js (для сборки/запуска фронта), npm/yarn/pnpm.

**Сервер:**
- HTTP API, доступный фронту по сети (локально/удалённо).

---

## 5. Вызов и загрузка

### 5.1. Запуск frontend (пример)
```bash
npm install
npm run start
# или
ng serve
```

### 5.2. Запуск backend

Backend должен быть доступен по API_BASE_URL (например http://localhost:8080).

## 6. Входные данные

### 6.1. Авторизация/регистрация

Register: JSON
``` json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "User"
}
```

Login: JSON
``` json
{
  "email": "user@example.com",
  "password": "password123"
}
```

### 6.2. Трекинг предметов
-	пользователь добавляет/удаляет предметы, формируя локальный список TrackedItem[]
-	при синке фронт отправляет/получает JSON со списком items

---

## 7. Выходные данные

### 7.1. Ответы auth

Register/Login: JSON

```json
{
  "token": "<jwt>",
  "user": {
    "id": "<uuid>",
    "email": "user@example.com",
    "name": "User",
    "avatarUrl": null
  }
}
```

### 7.2. Ответы tracked

GET /tracked:
```json
{ "items": [ { "id": "...", "iconLink": null, "updatedAt": 0 } ] }
```
PUT /tracked:
```json
{ "items": [] }
```
