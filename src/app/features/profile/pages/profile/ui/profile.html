<div class="page">
  <header class="header">
    <div class="header__row">
      <div class="header__left">
        @if (isAuthed()) {
          <h1 class="title">{{ userName() }}’s list</h1>
          <p class="subtitle muted">Synced tracked items</p>
        } @else {
          <h1 class="title">{{ 'profile.title' | t | async }}</h1>
          <p class="subtitle muted">{{ 'profile.subtitle' | t | async }}</p>
        }
      </div>

      <div class="header__actions">
        @if (isAuthed()) {
          <button class="icon-btn" type="button" (click)="openSyncDialog()" aria-label="Sync">
            ☁
          </button>

          <button class="icon-btn" type="button" (click)="logout()" aria-label="Logout" title="Logout">
            ⎋
          </button>
        } @else {
          <a class="btn btn--ghost" routerLink="/auth/login">Sign in</a>
          <a class="btn btn--ghost" routerLink="/auth/register">Register</a>
        }
      </div>
    </div>
  </header>

  <!-- Sync dialog (temporary, we will decorate later) -->
  @if (isAuthed() && syncDialogOpen()) {
    <div class="dialog-backdrop" (click)="closeSyncDialog()" aria-hidden="true"></div>

    <div class="dialog" role="dialog" aria-modal="true" aria-label="Sync dialog">
      <div class="dialog__head">
        <div class="dialog__title">Choose sync strategy</div>
        <button class="dialog__close" type="button" (click)="closeSyncDialog()" aria-label="Close">✕</button>
      </div>

      <div class="dialog__body">
        <div class="sync-actions">
          <button class="btn btn--primary" type="button" [disabled]="syncing()" (click)="runSync('localToServer')">
            Local → Server
          </button>

          <button class="btn btn--ghost" type="button" [disabled]="syncing()" (click)="runSync('serverToLocal')">
            Server → Local
          </button>

          <button class="btn btn--ghost" type="button" [disabled]="syncing()" (click)="runSync('merge')">
            Merge
          </button>
        </div>

        @if (syncError()) {
          <div class="sync-error">{{ syncError() }}</div>
        }

        @if (syncing()) {
          <div class="sync-note muted">Syncing…</div>
        }
      </div>
    </div>
  }

  <div class="mode-row" role="group" aria-label="Mode switch">
    <div class="segmented">
      <button type="button" class="seg-btn" [class.active]="mode() === 'pvp'" (click)="setMode('pvp')">
        {{ 'settings.mode.pvp' | t | async }}
      </button>
      <button type="button" class="seg-btn" [class.active]="mode() === 'pve'" (click)="setMode('pve')">
        {{ 'settings.mode.pve' | t | async }}
      </button>
    </div>
  </div>

  @if (isEmpty()) {
    <div class="empty muted">{{ 'profile.empty' | t | async }}</div>
    <a class="btn" routerLink="/items">{{ 'profile.goToSearch' | t | async }}</a>
  } @else {
    <div class="list">
      @for (it of rows(); track it.id) {
        <a class="row" [routerLink]="['/items', it.id]">
          <img class="icon" [src]="it.iconLink || placeholder" width="40" height="40" alt="" />

          <div class="main">
            @if (it.status === 'ready') {
              <div class="name">{{ it.name }}</div>
            } @else {
              <div class="skel skel-name" aria-hidden="true"></div>
            }

            @if (it.status === 'ready') {
              <div class="id muted">
                {{ 'profile.avg24h' | t | async }}:
                @if (it.avg24hPrice !== null && it.avg24hPrice !== undefined) {
                  {{ it.avg24hPrice }}
                } @else {
                  —
                }
              </div>
            } @else {
              <div class="skel skel-price" aria-hidden="true"></div>
            }
          </div>

          <div class="chev" aria-hidden="true">›</div>
        </a>
      }
    </div>
  }
</div>
