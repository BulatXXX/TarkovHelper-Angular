<div class="page">
  <header class="header">
    <h1 class="title">{{ 'items.search.title' | t | async }}</h1>
    <p class="subtitle muted">{{ 'items.search.subtitle' | t | async }}</p>
  </header>

  <div class="search-box">
    <div class="search">
      <input
        class="input"
        type="text"
        [formControl]="query"
        [placeholder]="('items.search.placeholder' | t | async) ?? ''"
        autocomplete="off"
      />

      @if (history$ | async; as history) {
        @if (isQueryEmpty && history.length > 0) {
          <div class="history-popover">
            <div class="history">
              <div class="history-head">
                <div class="history-title">{{ 'history.title' | t | async }}</div>
                <button class="history-clear" type="button" (click)="clearHistory()">
                  {{ 'history.clear' | t | async }}
                </button>
              </div>

              <div class="history-list">
                @for (h of history; track h.id) {
                  <a class="history-row" [routerLink]="['/items', h.id]">
                    <img class="icon" [src]="h.iconLink || placeholder" width="32" height="32" alt="" />
                    <div class="name">{{ h.name }}</div>
                    <div class="chev" aria-hidden="true">›</div>
                  </a>
                }
              </div>
            </div>
          </div>
        }
      }
    </div>
  </div>

  @if (viewModel$ | async; as vm) {

    @if (vm.status === 'idle') {
      <div class="hint muted">{{ 'items.search.idle' | t | async }}</div>
    }

    @if (vm.status === 'loading') {
      <div class="list skeleton-list" aria-hidden="true">
        @for (_ of [1,2,3,4,5,6]; track _) {
          <div class="row row-skel">
            <div class="icon skel skel-icon"></div>
            <div class="name skel skel-text"></div>
            <div class="chev skel skel-chev"></div>
          </div>
        }
      </div>
    }

    @if (vm.status === 'error') {
      <div class="error">
        <div class="error-title">{{ 'items.search.errorTitle' | t | async }}</div>
        <div class="error-text">{{ vm.errorMessage }}</div>
      </div>
    }

    @if (vm.status === 'ready') {
      @if (vm.items.length === 0) {
        <div class="hint muted">{{ 'items.search.empty' | t | async }}</div>
      } @else {
        <div class="list">
          @for (it of vm.items; track it.id) {
            <a class="row" [routerLink]="['/items', it.id]">
              <img class="icon" [src]="it.iconLink || placeholder" width="40" height="40" alt="" />
              <div class="name">{{ it.name }}</div>
              <div class="chev" aria-hidden="true">›</div>
            </a>
          }
        </div>
      }
    }

  }
</div>
