<div class="page">
  <header class="header">
    <h1 class="title">Items search</h1>
    <p class="subtitle muted">Type at least 2 characters to search</p>
  </header>

  <div class="search-box" (focusin)="onFocusIn()" (focusout)="onFocusOut($event)">
    <div class="search">
      <input
        class="input"
        type="text"
        [formControl]="query"
        placeholder="e.g. lab, salewa, ai-2..."
        autocomplete="off"
      />
    </div>

    @if (viewModel$ | async; as s) {
      @if (s.showHistory && s.query.trim().length === 0) {
        @if (history$ | async; as history) {
          @if (history.length > 0) {
            <div class="history">
              <div class="history-head">
                <div class="history-title">Recently viewed</div>
                <button class="history-clear" type="button" (click)="clearHistory()">
                  Clear
                </button>
              </div>

              <div class="history-list">
                @for (h of history; track h.id) {
                  <a class="history-row" [routerLink]="['/items', h.id]">
                    <img class="icon" [ngSrc]="h.iconLink ?? placeholder" width="32" height="32" alt="" />
                    <div class="name">{{ h.name }}</div>
                    <div class="chev" aria-hidden="true">›</div>
                  </a>
                }
              </div>
            </div>
          }
        }
      }
    }
  </div>

  @if (viewModel$ | async; as vm) {
    @if (vm.status === 'idle') {
      <div class="hint muted">Start typing to see results…</div>
    }

    @if (vm.status === 'loading') {
      <div class="hint muted">Loading…</div>
    }

    @if (vm.status === 'error') {
      <div class="error">
        <div class="error-title">Request failed</div>
        <div class="error-text">{{ vm.errorMessage }}</div>
      </div>
    }

    @if (vm.status === 'ready') {
      @if (vm.items.length === 0) {
        <div class="hint muted">Nothing found</div>
      } @else {
        <div class="list">
          @for (it of vm.items; track it.id) {
            <a class="row" [routerLink]="['/items', it.id]">
              <img
                class="icon"
                [ngSrc]="it.iconLink ?? placeholder"
                width="40"
                height="40"
                alt=""
              />
              <div class="name">{{ it.name }}</div>
              <div class="chev" aria-hidden="true">›</div>
            </a>
          }
        </div>
      }
    }
  }
</div>
