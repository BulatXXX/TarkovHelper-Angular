<div class="page">
  <a class="back-btn" routerLink="/items" aria-label="Back to search">
    <span class="back-ico" aria-hidden="true">←</span>
    <span>{{ 'common.back' | t | async }}</span>
  </a>

  @if (state$ | async; as s) {

    @if (s.status === 'loading' || s.status === 'idle') {
      <div class="card" aria-busy="true">
        <button class="track-icon-btn" type="button" disabled aria-hidden="true" title="Track">☆</button>

        <div class="top">
          <div class="icon-skel skel" aria-hidden="true"></div>

          <div class="titles">
            <div class="skel sk-title" aria-hidden="true"></div>
            <div class="skel sk-id" aria-hidden="true"></div>
            <div class="skel sk-price" aria-hidden="true"></div>
          </div>
        </div>

        <div class="desc-skel" aria-hidden="true">
          <div class="skel sk-line w-90"></div>
          <div class="skel sk-line w-80"></div>
          <div class="skel sk-line w-70"></div>
        </div>

        <div class="meta" aria-hidden="true">
          <span class="pill skel sk-pill"></span>
        </div>
      </div>
    }

    @else if (s.status === 'ready' && s.item) {
      <div class="card">
        <button
          class="track-icon-btn"
          type="button"
          (click)="toggleTracked()"
          [class.is-tracked]="s.tracked"
          [attr.aria-label]="s.tracked ? 'Untrack item' : 'Track item'"
          [title]="s.tracked ? 'Untrack' : 'Track'"
        >
          {{ s.tracked ? '★' : '☆' }}
        </button>

        <div class="top">
          <div class="icon-wrap">
            <img
              class="icon"
              [src]="s.item.image512pxLink ?? s.item.iconLink ?? placeholder"
              width="128"
              height="128"
              [alt]="s.item.name"
            />
          </div>

          <div class="titles">
            <h1 class="name">{{ s.item.name }}</h1>

            <div class="id">
              {{ 'items.details.idLabel' | t | async }}: {{ s.item.id }}
            </div>

            <div class="price">
              {{ 'items.details.priceLabel' | t | async }}:
              @if (s.item.avg24hPrice !== null) {
                <b>{{ s.item.avg24hPrice }}</b>
              } @else {
                <span class="muted">{{ 'items.details.priceMissing' | t | async }}</span>
              }
            </div>
          </div>
        </div>

        @if (s.item.description) {
          <p class="desc">{{ s.item.description }}</p>
        }

        <div class="meta">
          @if (s.item.width !== null && s.item.height !== null) {
            <span class="pill">
              {{ 'items.details.sizeLabel' | t | async }}: {{ s.item.width }}×{{ s.item.height }}
            </span>
          }
        </div>
      </div>
    }

    @else if (s.status === 'error') {
      <div class="error">
        <h2>{{ 'items.details.notFoundTitle' | t | async }}</h2>
        <p class="muted">
          {{ 'items.details.unknownId' | t:{ id: (s.id ?? '—') } | async }}
        </p>
        <p class="muted">{{ s.errorMessage }}</p>
      </div>
    }
  }
</div>
